From b57200dd3150b124e534bb02713646242ec4f90b Mon Sep 17 00:00:00 2001
From: sanchuanhehe <wyihe5220@gmail.com>
Date: Tue, 18 Nov 2025 21:12:22 +0800
Subject: [PATCH] Add OpenHarmony (OHOS) target support to GCC

This patch adds comprehensive support for OpenHarmony OS across multiple
architectures (AArch64, ARM, x86/x86_64, RISC-V, MIPS). OpenHarmony is an
open-source distributed operating system that uses musl libc.

The implementation follows similar patterns to existing Linux targets,
with architecture-specific headers defining dynamic linker paths, library
directories, and compilation flags. Key features include:

- OHOS-specific target recognition in config.sub
- Multi-architecture support with proper triplet definitions
- Dynamic linker paths following musl conventions
- Architecture-specific library and header search paths
- Thread support via POSIX threads (similar to other Linux targets)
- Stack protection enabled by default for security

ChangeLog:

	* config.sub: Add OHOS target recognition in OS validation
	and kernel-OS combinations for linux-ohos triplets.

gcc/ChangeLog:

	* config.gcc: Add OHOS target cases for aarch64, arm, i386/x86_64,
	riscv, and mips architectures. Set DEFAULT_LIBC to LIBC_MUSL for
	OHOS targets. Add OHOS to indirect function support list.
	* system.h (__GLIBC_PREREQ): Define compatibility macro for non-glibc
	systems to prevent build errors on musl-based targets.
	* config/aarch64/aarch64-ohos.h: New file. AArch64-specific OHOS
	configuration with LP64 ABI support and Cortex-A53 errata fixes.
	* config/aarch64/t-aarch64-ohos: New file. AArch64 OHOS makefile
	fragment with multilib configuration.
	* config/arm/arm-ohos.h: New file. ARM-specific OHOS configuration
	with EABI support and float ABI variants (soft/hard float).
	* config/arm/t-arm-ohos: New file. ARM OHOS makefile fragment.
	* config/i386/i386-ohos.h: New file. x86/x86_64-specific OHOS
	configuration supporting both 32-bit and 64-bit targets.
	* config/mips/mips-ohos.h: New file. MIPS-specific OHOS configuration
	supporting both big-endian and little-endian variants.
	* config/ohos-paths.h: New file. OHOS filesystem layout definitions
	including standard SDK paths for headers and libraries.
	* config/ohos.h: New file. Generic OHOS configuration with musl libc
	integration, security features, and library specifications.
	* config/riscv/riscv-ohos.h: New file. RISC-V-specific OHOS
	configuration with relaxation support.
	* config/t-ohos: New file. OHOS-specific makefile fragment adjusting
	multilib directory names from linux-gnu to linux-ohos.

libcpp/ChangeLog:

	* system.h (__GLIBC_PREREQ): Define compatibility macro for non-glibc
	systems to prevent preprocessor errors when cross-compiling.

libgcc/ChangeLog:

	* config.host: Add aarch64*-*-linux-ohos target configuration with
	software floating point support, LSE atomics, and unwind support.
	* gthr-posix.h (defined): Exclude pthread_cancel on OHOS targets
	(similar to Bionic) as it's not supported by musl libc in OHOS.

libstdc++-v3/ChangeLog:

	* configure.host: Add linux-ohos case to use generic OS headers,
	consistent with musl-based Linux distributions.
---
 config.sub                        |   4 +-
 gcc/config.gcc                    |  87 ++++++++++++++++-
 gcc/config/aarch64/aarch64-ohos.h | 141 +++++++++++++++++++++++++++
 gcc/config/aarch64/t-aarch64-ohos |  28 ++++++
 gcc/config/arm/arm-ohos.h         | 131 +++++++++++++++++++++++++
 gcc/config/arm/t-arm-ohos         |  28 ++++++
 gcc/config/i386/i386-ohos.h       | 125 ++++++++++++++++++++++++
 gcc/config/mips/mips-ohos.h       | 140 +++++++++++++++++++++++++++
 gcc/config/ohos-paths.h           |  74 +++++++++++++++
 gcc/config/ohos.h                 | 152 ++++++++++++++++++++++++++++++
 gcc/config/riscv/riscv-ohos.h     | 131 +++++++++++++++++++++++++
 gcc/config/t-ohos                 |   2 +
 gcc/system.h                      |   6 ++
 libcpp/system.h                   |   5 +
 libgcc/config.host                |   9 ++
 libgcc/gthr-posix.h               |   4 +-
 libstdc++-v3/configure.host       |   3 +
 17 files changed, 1065 insertions(+), 5 deletions(-)
 create mode 100644 gcc/config/aarch64/aarch64-ohos.h
 create mode 100644 gcc/config/aarch64/t-aarch64-ohos
 create mode 100644 gcc/config/arm/arm-ohos.h
 create mode 100644 gcc/config/arm/t-arm-ohos
 create mode 100644 gcc/config/i386/i386-ohos.h
 create mode 100644 gcc/config/mips/mips-ohos.h
 create mode 100644 gcc/config/ohos-paths.h
 create mode 100644 gcc/config/ohos.h
 create mode 100644 gcc/config/riscv/riscv-ohos.h
 create mode 100644 gcc/config/t-ohos

diff --git a/config.sub b/config.sub
index 38f3d037a..0a04e2db3 100755
--- a/config.sub
+++ b/config.sub
@@ -1749,7 +1749,7 @@ case $os in
 	     | onefs* | tirtos* | phoenix* | fuchsia* | redox* | bme* \
 	     | midnightbsd* | amdhsa* | unleashed* | emscripten* | wasi* \
 	     | nsk* | powerunix* | genode* | zvmoe* | qnx* | emx* | zephyr* \
-	     | fiwix* )
+	     | fiwix* | ohos* )
 		;;
 	# This one is extra strict with allowed versions
 	sco3.2v2 | sco3.2v[4-9]* | sco5v6*)
@@ -1767,7 +1767,7 @@ esac
 # (given a valid OS), if there is a kernel.
 case $kernel-$os in
 	linux-gnu* | linux-dietlibc* | linux-android* | linux-newlib* \
-		   | linux-musl* | linux-relibc* | linux-uclibc* )
+		   | linux-musl* | linux-relibc* | linux-uclibc* | linux-ohos* )
 		;;
 	uclinux-uclibc* )
 		;;
diff --git a/gcc/config.gcc b/gcc/config.gcc
index 087aaa7be..ae5524c36 100644
--- a/gcc/config.gcc
+++ b/gcc/config.gcc
@@ -920,6 +920,9 @@ case ${target} in
     *-*-*musl*)
       tm_defines="$tm_defines DEFAULT_LIBC=LIBC_MUSL"
       ;;
+    *-*-*ohos*)
+      tm_defines="$tm_defines DEFAULT_LIBC=LIBC_MUSL"
+      ;;
     *)
       tm_defines="$tm_defines DEFAULT_LIBC=LIBC_GLIBC"
       ;;
@@ -1236,6 +1239,84 @@ aarch64*-*-netbsd*)
 	tmake_file="${tmake_file} aarch64/t-aarch64 aarch64/t-aarch64-netbsd"
 	extra_options="${extra_options} netbsd.opt netbsd-elf.opt"
 	;;
+aarch64*-*-linux-ohos*)
+	tm_file="${tm_file} elfos.h gnu-user.h linux.h ohos.h glibc-stdint.h"
+	tm_file="${tm_file} aarch64/aarch64-elf.h aarch64/aarch64-errata.h aarch64/aarch64-linux.h aarch64/aarch64-ohos.h"
+	tmake_file="${tmake_file} aarch64/t-aarch64 aarch64/t-aarch64-ohos"
+	tm_defines="${tm_defines} TARGET_DEFAULT_ASYNC_UNWIND_TABLES=1"
+	gas=yes gnu_ld=yes
+	;;
+arm*-*-linux-ohos*)
+	tm_file="elfos.h gnu-user.h linux.h ohos.h glibc-stdint.h arm/elf.h arm/linux-gas.h arm/linux-elf.h"
+	case $target in
+	arm*b-*-linux-ohos*)
+	    tm_defines="${tm_defines} TARGET_BIG_ENDIAN_DEFAULT=1"
+	    ;;
+	esac
+	tmake_file="${tmake_file} arm/t-arm arm/t-arm-elf arm/t-bpabi arm/t-linux-eabi arm/t-arm-ohos"
+	tm_file="$tm_file arm/bpabi.h arm/linux-eabi.h arm/aout.h arm/arm.h arm/arm-ohos.h"
+	gas=yes gnu_ld=yes
+	;;
+i[34567]86-*-linux-ohos* | x86_64-*-linux-ohos*)
+	tm_file="${tm_file} i386/unix.h i386/att.h elfos.h gnu-user.h ohos.h glibc-stdint.h \
+		 i386/gnu-user-common.h"
+	case ${target} in
+	i[34567]86-*-linux-ohos*)
+		tm_file="${tm_file} linux.h i386/linux-common.h i386/linux.h i386/i386-ohos.h"
+		;;
+	x86_64-*-linux-ohos*)
+		tm_file="${tm_file} i386/x86-64.h i386/gnu-user64.h linux.h i386/linux-common.h i386/linux64.h i386/i386-ohos.h"
+		;;
+	esac
+	gas=yes gnu_ld=yes
+	;;
+riscv*-*-linux-ohos*)
+	tm_file="elfos.h gnu-user.h linux.h ohos.h glibc-stdint.h ${tm_file} riscv/linux.h riscv/riscv-ohos.h"
+	case "x${enable_multilib}" in
+	xno) ;;
+	xyes) tmake_file="${tmake_file} riscv/t-linux-multilib" ;;
+	*) echo "Unknown value for enable_multilib"; exit 1
+	esac
+	tmake_file="${tmake_file} riscv/t-riscv riscv/t-linux"
+	tm_defines="${tm_defines} TARGET_DEFAULT_ASYNC_UNWIND_TABLES=1"
+	gas=yes gnu_ld=yes
+	;;
+mips*-*-linux-ohos*)
+	tm_file="elfos.h gnu-user.h linux.h ohos.h glibc-stdint.h ${tm_file} mips/linux.h mips/mips-ohos.h"
+	tmake_file="${tmake_file} mips/t-mips"
+	extra_options="${extra_options} linux.opt"
+	case ${target} in
+	mipsisa32r6*)
+		default_mips_arch=mips32r6
+		;;
+	mipsisa32r2*)
+		default_mips_arch=mips32r2
+		;;
+	mipsisa32*)
+		default_mips_arch=mips32
+		;;
+	mips64el-st-linux-gnu)
+		default_mips_abi=n32
+		;;
+	mips64octeon*-*-linux*)
+		default_mips_abi=n32
+		default_mips_arch=octeon
+		;;
+	mipsisa64r6*-*-linux*)
+		default_mips_abi=n32
+		default_mips_arch=mips64r6
+		;;
+	mipsisa64r2*-*-linux*)
+		default_mips_abi=n32
+		default_mips_arch=mips64r2
+		;;
+	mips64*-*-linux* | mipsisa64*-*-linux*)
+		default_mips_abi=n32
+		default_mips_arch=mips64
+		;;
+	esac
+	gas=yes gnu_ld=yes
+	;;
 aarch64*-*-linux*)
 	tm_file="${tm_file} elfos.h gnu-user.h linux.h glibc-stdint.h"
 	tm_file="${tm_file} aarch64/aarch64-elf.h aarch64/aarch64-errata.h aarch64/aarch64-linux.h"
@@ -3660,6 +3741,9 @@ case ${target} in
 *-linux-musl*)
 	tmake_file="${tmake_file} t-musl"
 	;;
+*-linux-ohos*)
+	tmake_file="${tmake_file} t-ohos"
+	;;
 *-linux-uclibc*)
 	tmake_file="${tmake_file} t-uclibc"
 	;;
@@ -3668,7 +3752,7 @@ esac
 # Assume the existence of indirect function support and allow the use of the
 # resolver attribute.
 case ${target} in
-*-*-linux*android*|*-*-linux*uclibc*|*-*-linux*musl*)
+*-*-linux*android*|*-*-linux*uclibc*|*-*-linux*musl*|*-*-linux*ohos*)
         ;;
 *-*-kfreebsd*-gnu | *-*-kopensolaris*-gnu)
         ;;
@@ -5108,6 +5192,7 @@ case "${target}" in
 		case ${target} in
 		  *-linux-gnu*) triplet_os="linux-gnu";;
 		  *-linux-musl*) triplet_os="linux-musl";;
+		  *-linux-ohos*) triplet_os="linux-ohos";;
 		  *-elf*) triplet_os="elf";;
 		  *)
 			  echo "Unsupported target ${target}." 1>&2
diff --git a/gcc/config/aarch64/aarch64-ohos.h b/gcc/config/aarch64/aarch64-ohos.h
new file mode 100644
index 000000000..5b3425fc1
--- /dev/null
+++ b/gcc/config/aarch64/aarch64-ohos.h
@@ -0,0 +1,137 @@
+/* Definitions for AArch64 running OpenHarmony (OHOS).
+   Copyright (C) 2024 Free Software Foundation, Inc.
+
+   This file is part of GCC.
+
+   GCC is free software; you can redistribute it and/or modify it
+   under the terms of the GNU General Public License as published by
+   the Free Software Foundation; either version 3, or (at your option)
+   any later version.
+
+   GCC is distributed in the hope that it will be useful, but
+   WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   General Public License for more details.
+
+   You should have received a copy of the GNU General Public License
+   along with GCC; see the file COPYING3.  If not see
+   <http://www.gnu.org/licenses/>.  */
+
+#ifndef GCC_AARCH64_OHOS_H
+#define GCC_AARCH64_OHOS_H
+
+/* Define architecture-specific dynamic linker for AArch64 */
+#define OHOS_ARCH_DYNAMIC_LINKER "/lib/ld-musl-aarch64.so.1"
+
+/* Include the generic OpenHarmony configuration */
+/* Note: ohos.h is already included via tm.h, no need to include again */
+
+/* AArch64 OpenHarmony uses the LP64 ABI */
+#undef TARGET_FIX_ERR_A53_835769_DEFAULT
+#define TARGET_FIX_ERR_A53_835769_DEFAULT 1
+#undef TARGET_FIX_ERR_A53_843419_DEFAULT
+#define TARGET_FIX_ERR_A53_843419_DEFAULT 1
+
+/* OpenHarmony on AArch64 uses musl-style 64-bit dynamic linker.
+   The dynamic linker is already selected by architecture-aware logic
+   in ohos.h, so we don't need to override it here unless there are
+   AArch64-specific requirements. */
+
+/* AArch64-specific OpenHarmony defines - override Linux configuration */
+#ifdef TARGET_OS_CPP_BUILTINS
+#undef TARGET_OS_CPP_BUILTINS
+#endif
+#define TARGET_OS_CPP_BUILTINS()		\
+  do						\
+    {						\
+      GNU_USER_TARGET_OS_CPP_BUILTINS();	\
+      OHOS_BASE_OS_CPP_BUILTINS();		\
+      builtin_define ("__aarch64__");		\
+      builtin_assert ("cpu=aarch64");		\
+      builtin_assert ("machine=aarch64");	\
+    }						\
+  while (0)
+
+/* OpenHarmony library paths for AArch64 */
+#define OHOS_ARCH_LIB_DIR "aarch64-linux-ohos"
+
+/* Inject architecture-specific include directories via the CPP spec. */
+#define OHOS_MULTIARCH_CPP_SPEC OHOS_MULTIARCH_INCLUDE_SPEC(OHOS_ARCH_LIB_DIR)
+#ifndef SUBTARGET_CPP_SPEC
+#define SUBTARGET_CPP_SPEC ""
+#endif
+#define OHOS_PREV_SUBTARGET_CPP_SPEC SUBTARGET_CPP_SPEC
+#undef SUBTARGET_CPP_SPEC
+#define SUBTARGET_CPP_SPEC OHOS_PREV_SUBTARGET_CPP_SPEC OHOS_MULTIARCH_CPP_SPEC
+#undef OHOS_PREV_SUBTARGET_CPP_SPEC
+#undef OHOS_MULTIARCH_CPP_SPEC
+
+/* Enhanced library search paths for OpenHarmony */
+#undef STANDARD_STARTFILE_PREFIX_1
+#define STANDARD_STARTFILE_PREFIX_1 "/usr/lib/"
+
+#undef STANDARD_STARTFILE_PREFIX_2
+#define STANDARD_STARTFILE_PREFIX_2 "/lib/"
+
+/* Add architecture-specific library directories for OHOS */
+#undef MD_EXEC_PREFIX
+#define MD_EXEC_PREFIX "/usr/lib/" OHOS_ARCH_LIB_DIR "/"
+
+#undef MD_STARTFILE_PREFIX
+#define MD_STARTFILE_PREFIX "/usr/lib/" OHOS_ARCH_LIB_DIR "/"
+
+#undef MD_STARTFILE_PREFIX_1
+#define MD_STARTFILE_PREFIX_1 "/lib/" OHOS_ARCH_LIB_DIR "/"
+
+/* Override STARTFILE and ENDFILE specs to use architecture-specific paths */
+#undef STARTFILE_SPEC
+#define STARTFILE_SPEC \
+  "%{!shared: \
+     %{pg|p|profile:%R/usr/lib/" OHOS_ARCH_LIB_DIR "/gcrt1.o%s; \
+       pie:%R/usr/lib/" OHOS_ARCH_LIB_DIR "/Scrt1.o%s; \
+       :%R/usr/lib/" OHOS_ARCH_LIB_DIR "/crt1.o%s}} \
+   %R/usr/lib/" OHOS_ARCH_LIB_DIR "/crti.o%s \
+   %{static:crtbeginT.o%s;shared|pie:crtbeginS.o%s;:crtbegin.o%s}"
+
+#undef ENDFILE_SPEC
+#define ENDFILE_SPEC \
+  "%{shared|pie:crtendS.o%s;:crtend.o%s} \
+   %R/usr/lib/" OHOS_ARCH_LIB_DIR "/crtn.o%s"
+
+#ifdef LINK_SPEC
+#undef LINK_SPEC
+#endif
+/* Define the link spec for AArch64 OpenHarmony */
+#define LINK_SPEC						\
+  "%{mbig-endian:-EB} %{mlittle-endian:-EL} "			\
+  "%{shared:-shared} "						\
+  "%{!shared: "							\
+    "%{!static: "						\
+      "%{rdynamic:-export-dynamic} "				\
+      "-dynamic-linker " OHOS_DYNAMIC_LINKER "} "		\
+    "%{static:-static}} "					\
+  "%{mfix-cortex-a53-835769:--fix-cortex-a53-835769} "		\
+  "%{mfix-cortex-a53-843419:--fix-cortex-a53-843419} "		\
+  "-L%R/usr/lib/" OHOS_ARCH_LIB_DIR " "				\
+  "-L%R/usr/lib " 						\
+  "-L%R/lib/" OHOS_ARCH_LIB_DIR " "				\
+  "-L%R/lib "
+
+/* Default to little endian */
+#undef TARGET_DEFAULT_ASYNC_UNWIND_TABLES
+#define TARGET_DEFAULT_ASYNC_UNWIND_TABLES 1
+
+/* AArch64 OpenHarmony multilib configuration */
+#undef MULTILIB_DEFAULTS
+#define MULTILIB_DEFAULTS { "mabi=lp64" }
+
+/* Use the AAPCS64 calling convention */
+#undef TARGET_DEFAULT
+#define TARGET_DEFAULT (MASK_LITTLE_ENDIAN)
+
+/* Support for outline atomics */
+#ifndef TARGET_OUTLINE_ATOMICS
+#define TARGET_OUTLINE_ATOMICS 1
+#endif
+
+#endif /* GCC_AARCH64_OHOS_H */
diff --git a/gcc/config/aarch64/t-aarch64-ohos b/gcc/config/aarch64/t-aarch64-ohos
new file mode 100644
index 000000000..2ec312e61
--- /dev/null
+++ b/gcc/config/aarch64/t-aarch64-ohos
@@ -0,0 +1,28 @@
+# Machine description for AArch64 architecture - OpenHarmony (OHOS) specific.
+#  Copyright (C) 2024 Free Software Foundation, Inc.
+#  Contributed by ARM Ltd.
+#
+#  This file is part of GCC.
+#
+#  GCC is free software; you can redistribute it and/or modify it
+#  under the terms of the GNU General Public License as published by
+#  the Free Software Foundation; either version 3, or (at your option)
+#  any later version.
+#
+#  GCC is distributed in the hope that it will be useful, but
+#  WITHOUT ANY WARRANTY; without even the implied warranty of
+#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#  General Public License for more details.
+#
+#  You should have received a copy of the GNU General Public License
+#  along with GCC; see the file COPYING3.  If not see
+#  <http://www.gnu.org/licenses/>.
+
+LIB1ASMSRC   = aarch64/lib1funcs.asm
+LIB1ASMFUNCS = _aarch64_sync_cache_range
+
+AARCH_BE = $(if $(findstring TARGET_BIG_ENDIAN_DEFAULT=1, $(tm_defines)),_be)
+MULTILIB_OSDIRNAMES = mabi.lp64=../lib64$(call if_multiarch,:aarch64$(AARCH_BE)-linux-ohos)
+MULTIARCH_DIRNAME = $(call if_multiarch,aarch64$(AARCH_BE)-linux-ohos)
+
+MULTILIB_OSDIRNAMES += mabi.ilp32=../libilp32$(call if_multiarch,:aarch64$(AARCH_BE)-linux-ohos_ilp32)
diff --git a/gcc/config/arm/arm-ohos.h b/gcc/config/arm/arm-ohos.h
new file mode 100644
index 000000000..b2785b4ed
--- /dev/null
+++ b/gcc/config/arm/arm-ohos.h
@@ -0,0 +1,127 @@
+/* Definitions for ARM running OpenHarmony (OHOS).
+   Copyright (C) 2024 Free Software Foundation, Inc.
+
+   This file is part of GCC.
+
+   GCC is free software; you can redistribute it and/or modify it
+   under the terms of the GNU General Public License as published by
+   the Free Software Foundation; either version 3, or (at your option)
+   any later version.
+
+   GCC is distributed in the hope that it will be useful, but
+   WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   General Public License for more details.
+
+   You should have received a copy of the GNU General Public License
+   along with GCC; see the file COPYING3.  If not see
+   <http://www.gnu.org/licenses/>.  */
+
+#ifndef GCC_ARM_OHOS_H
+#define GCC_ARM_OHOS_H
+
+/* Define architecture-specific dynamic linker with float ABI support */
+#ifdef TARGET_HARD_FLOAT_ABI
+# define OHOS_ARCH_DYNAMIC_LINKER "/lib/ld-musl-armhf.so.1"
+#else
+# define OHOS_ARCH_DYNAMIC_LINKER "/lib/ld-musl-arm.so.1"
+#endif
+
+/* Include the generic OpenHarmony configuration */
+/* Note: ohos.h is already included via tm.h, no need to include again */
+
+/* ARM-specific OpenHarmony defines - override Linux configuration */
+#ifdef TARGET_OS_CPP_BUILTINS
+#undef TARGET_OS_CPP_BUILTINS
+#endif
+#define TARGET_OS_CPP_BUILTINS()		\
+  do						\
+    {						\
+      GNU_USER_TARGET_OS_CPP_BUILTINS();	\
+      OHOS_BASE_OS_CPP_BUILTINS();		\
+      builtin_define ("__arm__");		\
+      builtin_assert ("cpu=arm");		\
+      builtin_assert ("machine=arm");		\
+    }						\
+  while (0)
+
+/* OpenHarmony library paths for ARM */
+#ifdef TARGET_HARD_FLOAT_ABI
+# define OHOS_ARCH_LIB_DIR "arm-linux-ohoseabihf"
+#else
+# define OHOS_ARCH_LIB_DIR "arm-linux-ohos"
+#endif
+
+/* Inject architecture-specific include directories via the CPP spec. */
+#define OHOS_MULTIARCH_CPP_SPEC OHOS_MULTIARCH_INCLUDE_SPEC(OHOS_ARCH_LIB_DIR)
+#ifndef SUBTARGET_CPP_SPEC
+#define SUBTARGET_CPP_SPEC ""
+#endif
+#define OHOS_PREV_SUBTARGET_CPP_SPEC SUBTARGET_CPP_SPEC
+#undef SUBTARGET_CPP_SPEC
+#define SUBTARGET_CPP_SPEC OHOS_PREV_SUBTARGET_CPP_SPEC OHOS_MULTIARCH_CPP_SPEC
+#undef OHOS_PREV_SUBTARGET_CPP_SPEC
+#undef OHOS_MULTIARCH_CPP_SPEC
+
+/* Enhanced library search paths for OpenHarmony */
+#undef STANDARD_STARTFILE_PREFIX_1
+#define STANDARD_STARTFILE_PREFIX_1 "/usr/lib/"
+
+#undef STANDARD_STARTFILE_PREFIX_2
+#define STANDARD_STARTFILE_PREFIX_2 "/lib/"
+
+/* Add architecture-specific library directories for OHOS */
+#undef MD_EXEC_PREFIX
+#define MD_EXEC_PREFIX "/usr/lib/" OHOS_ARCH_LIB_DIR "/"
+
+#undef MD_STARTFILE_PREFIX
+#define MD_STARTFILE_PREFIX "/usr/lib/" OHOS_ARCH_LIB_DIR "/"
+
+#undef MD_STARTFILE_PREFIX_1
+#define MD_STARTFILE_PREFIX_1 "/lib/" OHOS_ARCH_LIB_DIR "/"
+
+/* Override STARTFILE and ENDFILE specs to use architecture-specific paths */
+#undef STARTFILE_SPEC
+#define STARTFILE_SPEC \
+  "%{!shared: \
+     %{pg|p|profile:%R/usr/lib/" OHOS_ARCH_LIB_DIR "/gcrt1.o%s; \
+       pie:%R/usr/lib/" OHOS_ARCH_LIB_DIR "/Scrt1.o%s; \
+       :%R/usr/lib/" OHOS_ARCH_LIB_DIR "/crt1.o%s}} \
+   %R/usr/lib/" OHOS_ARCH_LIB_DIR "/crti.o%s \
+   %{static:crtbeginT.o%s;shared|pie:crtbeginS.o%s;:crtbegin.o%s}"
+
+#undef ENDFILE_SPEC
+#define ENDFILE_SPEC \
+  "%{shared|pie:crtendS.o%s;:crtend.o%s} \
+   %R/usr/lib/" OHOS_ARCH_LIB_DIR "/crtn.o%s"
+#ifdef LINK_SPEC
+#undef LINK_SPEC
+#endif
+/* Define the link spec for ARM OpenHarmony */
+#define LINK_SPEC						\
+  "%{mbig-endian:-EB} %{mlittle-endian:-EL} "			\
+  "%{shared:-shared} "						\
+  "%{!shared: "							\
+    "%{!static: "						\
+      "%{rdynamic:-export-dynamic} "				\
+      "-dynamic-linker " OHOS_DYNAMIC_LINKER "} "		\
+    "%{static:-static}} "					\
+  "-L%R/usr/lib/" OHOS_ARCH_LIB_DIR " "				\
+  "-L%R/usr/lib " 						\
+  "-L%R/lib/" OHOS_ARCH_LIB_DIR " "				\
+  "-L%R/lib "
+
+/* ARM OpenHarmony uses EABI by default */
+#undef TARGET_DEFAULT_FLOAT_ABI
+#define TARGET_DEFAULT_FLOAT_ABI ARM_FLOAT_ABI_SOFT
+
+/* Default to little endian and async unwind tables */
+#undef TARGET_DEFAULT_ASYNC_UNWIND_TABLES
+#define TARGET_DEFAULT_ASYNC_UNWIND_TABLES 1
+
+/* ARM OpenHarmony multilib configuration */
+#undef MULTILIB_DEFAULTS
+#define MULTILIB_DEFAULTS \
+  { "marm", "mlittle-endian", "mfloat-abi=soft", "mno-thumb-interwork" }
+
+#endif /* GCC_ARM_OHOS_H */
diff --git a/gcc/config/arm/t-arm-ohos b/gcc/config/arm/t-arm-ohos
new file mode 100644
index 000000000..f0a37350e
--- /dev/null
+++ b/gcc/config/arm/t-arm-ohos
@@ -0,0 +1,28 @@
+# Machine description for ARM architecture - OpenHarmony (OHOS) specific.
+#  Copyright (C) 2024 Free Software Foundation, Inc.
+#  Contributed by ARM Ltd.
+#
+#  This file is part of GCC.
+#
+#  GCC is free software; you can redistribute it and/or modify it
+#  under the terms of the GNU General Public License as published by
+#  the Free Software Foundation; either version 3, or (at your option)
+#  any later version.
+#
+#  GCC is distributed in the hope that it will be useful, but
+#  WITHOUT ANY WARRANTY; without even the implied warranty of
+#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#  General Public License for more details.
+#
+#  You should have received a copy of the GNU General Public License
+#  along with GCC; see the file COPYING3.  If not see
+#  <http://www.gnu.org/licenses/>.
+
+LIB1ASMSRC = arm/lib1funcs.S
+LIB1ASMFUNCS = _dvmd_tls _bb_init_func
+
+ARM_BE = $(if $(findstring TARGET_BIG_ENDIAN_DEFAULT=1, $(tm_defines)),_be)
+MULTILIB_OSDIRNAMES = mfloat-abi.soft=../lib$(call if_multiarch,:arm$(ARM_BE)-linux-ohos)
+MULTIARCH_DIRNAME = $(call if_multiarch,arm$(ARM_BE)-linux-ohos)
+
+MULTILIB_OSDIRNAMES += mfloat-abi.hard=../lib/arm$(ARM_BE)-linux-ohoshf$(call if_multiarch,:arm$(ARM_BE)-linux-ohoshf)
diff --git a/gcc/config/i386/i386-ohos.h b/gcc/config/i386/i386-ohos.h
new file mode 100644
index 000000000..244fb959c
--- /dev/null
+++ b/gcc/config/i386/i386-ohos.h
@@ -0,0 +1,123 @@
+/* Definitions for x86_64 running OpenHarmony (OHOS).
+   Copyright (C) 2024 Free Software Foundation, Inc.
+
+   This file is part of GCC.
+
+   GCC is free software; you can redistribute it and/or modify it
+   under the terms of the GNU General Public License as published by
+   the Free Software Foundation; either version 3, or (at your option)
+   any later version.
+
+   GCC is distributed in the hope that it will be useful, but
+   WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   General Public License for more details.
+
+   You should have received a copy of the GNU General Public License
+   along with GCC; see the file COPYING3.  If not see
+   <http://www.gnu.org/licenses/>.  */
+
+#ifndef GCC_I386_OHOS_H
+#define GCC_I386_OHOS_H
+
+/* Define architecture-specific dynamic linker - match LLVM getDynamicLinker() */
+#if TARGET_X32
+# define OHOS_ARCH_DYNAMIC_LINKER "/lib/ld-musl-x32.so.1"
+#elif TARGET_64BIT
+# define OHOS_ARCH_DYNAMIC_LINKER "/lib/ld-musl-x86_64.so.1"
+#else
+# define OHOS_ARCH_DYNAMIC_LINKER "/lib/ld-musl-i386.so.1"
+#endif
+
+/* Include the generic OpenHarmony configuration */
+/* Note: ohos.h is already included via tm.h, no need to include again */
+
+/* x86/x86_64-specific OpenHarmony defines - override Linux configuration */
+#ifdef TARGET_OS_CPP_BUILTINS
+#undef TARGET_OS_CPP_BUILTINS
+#endif
+#define TARGET_OS_CPP_BUILTINS()		\
+  do						\
+    {						\
+      /* Include base GNU and OHOS defines */ \
+      GNU_USER_TARGET_OS_CPP_BUILTINS ();	\
+      OHOS_BASE_OS_CPP_BUILTINS ();		\
+      /* x86-specific defines already in GNU_USER_TARGET_OS_CPP_BUILTINS */ \
+    }						\
+  while (0)
+
+/* OpenHarmony library paths for x86 */
+#if TARGET_X32
+# define OHOS_ARCH_LIB_DIR "x86_64-linux-ohosx32"
+#elif TARGET_64BIT
+# define OHOS_ARCH_LIB_DIR "x86_64-linux-ohos"
+#else
+# define OHOS_ARCH_LIB_DIR "x86_64-linux-ohos"
+#else
+# define OHOS_ARCH_LIB_DIR "i386-linux-ohos"
+#endif
+
+/* Inject architecture-specific include directories via the CPP spec. */
+#define OHOS_MULTIARCH_CPP_SPEC OHOS_MULTIARCH_INCLUDE_SPEC(OHOS_ARCH_LIB_DIR)
+#ifndef SUBTARGET_CPP_SPEC
+#define SUBTARGET_CPP_SPEC ""
+#endif
+#define OHOS_PREV_SUBTARGET_CPP_SPEC SUBTARGET_CPP_SPEC
+#undef SUBTARGET_CPP_SPEC
+#define SUBTARGET_CPP_SPEC OHOS_PREV_SUBTARGET_CPP_SPEC OHOS_MULTIARCH_CPP_SPEC
+#undef OHOS_PREV_SUBTARGET_CPP_SPEC
+#undef OHOS_MULTIARCH_CPP_SPEC
+#undef STANDARD_STARTFILE_PREFIX_1
+#define STANDARD_STARTFILE_PREFIX_1 "/usr/lib/"
+
+#undef STANDARD_STARTFILE_PREFIX_2
+#define STANDARD_STARTFILE_PREFIX_2 "/lib/"
+
+/* Add architecture-specific library directories for OHOS */
+#undef MD_EXEC_PREFIX
+#define MD_EXEC_PREFIX "/usr/lib/" OHOS_ARCH_LIB_DIR "/"
+
+#undef MD_STARTFILE_PREFIX
+#define MD_STARTFILE_PREFIX "/usr/lib/" OHOS_ARCH_LIB_DIR "/"
+
+#undef MD_STARTFILE_PREFIX_1
+#define MD_STARTFILE_PREFIX_1 "/lib/" OHOS_ARCH_LIB_DIR "/"
+
+/* Override STARTFILE and ENDFILE specs to use architecture-specific paths */
+#undef STARTFILE_SPEC
+#define STARTFILE_SPEC \
+  "%{!shared: \
+     %{pg|p|profile:%R/usr/lib/" OHOS_ARCH_LIB_DIR "/gcrt1.o%s; \
+       pie:%R/usr/lib/" OHOS_ARCH_LIB_DIR "/Scrt1.o%s; \
+       :%R/usr/lib/" OHOS_ARCH_LIB_DIR "/crt1.o%s}} \
+   %R/usr/lib/" OHOS_ARCH_LIB_DIR "/crti.o%s \
+   %{static:crtbeginT.o%s;shared|pie:crtbeginS.o%s;:crtbegin.o%s}"
+
+#undef ENDFILE_SPEC
+#define ENDFILE_SPEC \
+  "%{shared|pie:crtendS.o%s;:crtend.o%s} \
+   %R/usr/lib/" OHOS_ARCH_LIB_DIR "/crtn.o%s"
+#ifdef LINK_SPEC
+#undef LINK_SPEC
+#endif
+/* Define the link spec for x86 OpenHarmony */
+#define LINK_SPEC						\
+  "%{" SPEC_32 ":-m elf_i386} "				\
+  "%{" SPEC_64 ":-m elf_x86_64} "				\
+  "%{shared:-shared} "						\
+  "%{!shared: "							\
+    "%{!static: "						\
+      "%{rdynamic:-export-dynamic} "				\
+      "%{" SPEC_32 ":-dynamic-linker " OHOS_DYNAMIC_LINKER "} "	\
+      "%{" SPEC_64 ":-dynamic-linker " OHOS_DYNAMIC_LINKER "}} "	\
+    "%{static:-static}} "					\
+  "-L%R/usr/lib/" OHOS_ARCH_LIB_DIR " "				\
+  "-L%R/usr/lib " 						\
+  "-L%R/lib/" OHOS_ARCH_LIB_DIR " "				\
+  "-L%R/lib "
+
+/* Default to little endian and async unwind tables */
+#undef TARGET_DEFAULT_ASYNC_UNWIND_TABLES
+#define TARGET_DEFAULT_ASYNC_UNWIND_TABLES 1
+
+#endif /* GCC_I386_OHOS_H */
diff --git a/gcc/config/mips/mips-ohos.h b/gcc/config/mips/mips-ohos.h
new file mode 100644
index 000000000..e7403e962
--- /dev/null
+++ b/gcc/config/mips/mips-ohos.h
@@ -0,0 +1,136 @@
+/* Definitions for MIPS running OpenHarmony (OHOS).
+   Copyright (C) 2024 Free Software Foundation, Inc.
+
+   This file is part of GCC.
+
+   GCC is free software; you can redistribute it and/or modify it
+   under the terms of the GNU General Public License as published by
+   the Free Software Foundation; either version 3, or (at your option)
+   any later version.
+
+   GCC is distributed in the hope that it will be useful, but
+   WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   General Public License for more details.
+
+   You should have received a copy of the GNU General Public License
+   along with GCC; see the file COPYING3.  If not see
+   <http://www.gnu.org/licenses/>.  */
+
+#ifndef GCC_MIPS_OHOS_H
+#define GCC_MIPS_OHOS_H
+
+/* Define architecture-specific dynamic linker - match LLVM getDynamicLinker() */
+#if TARGET_64BIT_DEFAULT
+# if TARGET_BIG_ENDIAN_DEFAULT
+#  define OHOS_ARCH_DYNAMIC_LINKER "/lib/ld-musl-mips64.so.1"
+# else
+#  define OHOS_ARCH_DYNAMIC_LINKER "/lib/ld-musl-mips64el.so.1"
+# endif
+#else
+# if TARGET_BIG_ENDIAN_DEFAULT
+#  define OHOS_ARCH_DYNAMIC_LINKER "/lib/ld-musl-mips.so.1"
+# else
+#  define OHOS_ARCH_DYNAMIC_LINKER "/lib/ld-musl-mipsel.so.1"
+# endif
+#endif
+
+/* Include the generic OpenHarmony configuration */
+/* Note: ohos.h is already included via tm.h, no need to include again */
+
+/* MIPS-specific OpenHarmony defines - override Linux configuration */
+#ifdef TARGET_OS_CPP_BUILTINS
+#undef TARGET_OS_CPP_BUILTINS
+#endif
+#define TARGET_OS_CPP_BUILTINS()		\
+  do						\
+    {						\
+      /* Include base GNU and OHOS defines */ \
+      GNU_USER_TARGET_OS_CPP_BUILTINS ();	\
+      OHOS_BASE_OS_CPP_BUILTINS ();		\
+      /* MIPS-specific defines */ \
+      builtin_define ("__mips__");		\
+      builtin_assert ("cpu=mips");		\
+      builtin_assert ("machine=mips");		\
+    }						\
+  while (0)
+
+/* OpenHarmony library paths for MIPS */
+#if TARGET_64BIT_DEFAULT
+# if TARGET_BIG_ENDIAN_DEFAULT
+#  define OHOS_ARCH_LIB_DIR "mips64-linux-ohos"
+# else
+#  define OHOS_ARCH_LIB_DIR "mips64el-linux-ohos"
+# endif
+#else
+# if TARGET_BIG_ENDIAN_DEFAULT
+#  define OHOS_ARCH_LIB_DIR "mips-linux-ohos"
+# else
+#  define OHOS_ARCH_LIB_DIR "mipsel-linux-ohos"
+# endif
+#endif
+
+/* Inject architecture-specific include directories via the CPP spec. */
+#define OHOS_MULTIARCH_CPP_SPEC OHOS_MULTIARCH_INCLUDE_SPEC(OHOS_ARCH_LIB_DIR)
+#ifndef SUBTARGET_CPP_SPEC
+#define SUBTARGET_CPP_SPEC ""
+#endif
+#define OHOS_PREV_SUBTARGET_CPP_SPEC SUBTARGET_CPP_SPEC
+#undef SUBTARGET_CPP_SPEC
+#define SUBTARGET_CPP_SPEC OHOS_PREV_SUBTARGET_CPP_SPEC OHOS_MULTIARCH_CPP_SPEC
+#undef OHOS_PREV_SUBTARGET_CPP_SPEC
+#undef OHOS_MULTIARCH_CPP_SPEC
+
+/* Enhanced library search paths for OpenHarmony */
+#undef STANDARD_STARTFILE_PREFIX_1
+#define STANDARD_STARTFILE_PREFIX_1 "/usr/lib/"
+
+#undef STANDARD_STARTFILE_PREFIX_2
+#define STANDARD_STARTFILE_PREFIX_2 "/lib/"
+
+/* Add architecture-specific library directories for OHOS */
+#undef MD_EXEC_PREFIX
+#define MD_EXEC_PREFIX "/usr/lib/" OHOS_ARCH_LIB_DIR "/"
+
+#undef MD_STARTFILE_PREFIX
+#define MD_STARTFILE_PREFIX "/usr/lib/" OHOS_ARCH_LIB_DIR "/"
+
+#undef MD_STARTFILE_PREFIX_1
+#define MD_STARTFILE_PREFIX_1 "/lib/" OHOS_ARCH_LIB_DIR "/"
+
+/* Override STARTFILE and ENDFILE specs to use architecture-specific paths */
+#undef STARTFILE_SPEC
+#define STARTFILE_SPEC \
+  "%{!shared: \
+     %{pg|p|profile:%R/usr/lib/" OHOS_ARCH_LIB_DIR "/gcrt1.o%s; \
+       pie:%R/usr/lib/" OHOS_ARCH_LIB_DIR "/Scrt1.o%s; \
+       :%R/usr/lib/" OHOS_ARCH_LIB_DIR "/crt1.o%s}} \
+   %R/usr/lib/" OHOS_ARCH_LIB_DIR "/crti.o%s \
+   %{static:crtbeginT.o%s;shared|pie:crtbeginS.o%s;:crtbegin.o%s}"
+
+#undef ENDFILE_SPEC
+#define ENDFILE_SPEC \
+  "%{shared|pie:crtendS.o%s;:crtend.o%s} \
+   %R/usr/lib/" OHOS_ARCH_LIB_DIR "/crtn.o%s"
+
+/* Define the link spec for MIPS OpenHarmony */
+#define LINK_SPEC						\
+  "%{G*} "							\
+  "%{mips1} %{mips2} %{mips3} %{mips4} "			\
+  "%{bestGnum} %{shared} %{non_shared} "			\
+  "%{call_shared} %{no_archive} %{exact_version} "		\
+  "%{!shared: "							\
+    "%{!static: "						\
+      "%{rdynamic:-export-dynamic} "				\
+      "-dynamic-linker " OHOS_DYNAMIC_LINKER "} "		\
+    "%{static:-static}} "					\
+  "-L%R/usr/lib/" OHOS_ARCH_LIB_DIR " "				\
+  "-L%R/usr/lib " 						\
+  "-L%R/lib/" OHOS_ARCH_LIB_DIR " "				\
+  "-L%R/lib "
+
+/* Default to little endian and async unwind tables */
+#undef TARGET_DEFAULT_ASYNC_UNWIND_TABLES
+#define TARGET_DEFAULT_ASYNC_UNWIND_TABLES 1
+
+#endif /* GCC_MIPS_OHOS_H */
diff --git a/gcc/config/ohos-paths.h b/gcc/config/ohos-paths.h
new file mode 100644
index 000000000..a0a273dac
--- /dev/null
+++ b/gcc/config/ohos-paths.h
@@ -0,0 +1,78 @@
+/* OpenHarmony sysroot and toolchain utilities
+   Copyright (C) 2024 Free Software Foundation, Inc.
+
+This file is part of GCC.
+
+GCC is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 3, or (at your option)
+any later version.
+
+GCC is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with GCC; see the file COPYING3.  If not see
+<http://www.gnu.org/licenses/>.  */
+
+#ifndef GCC_OHOS_PATHS_H
+#define GCC_OHOS_PATHS_H
+
+/* OpenHarmony standard filesystem layout support.
+
+   This header defines the standard paths for OpenHarmony SDK layout:
+   - Headers: sysroot/usr/include/{arch}/
+   - Libraries: sysroot/usr/lib/{arch}/
+   - CRT files: sysroot/usr/lib/{arch}/crt*.o
+
+   The paths are designed to work with the official OpenHarmony SDK
+   structure as distributed by the OpenHarmony project.
+*/
+
+/* Architecture-specific include directory patterns */
+#define OHOS_ARCH_INCLUDE_PATTERN "/usr/include/%s"
+#define OHOS_GENERIC_INCLUDE_PATH "/usr/include"
+
+/* Architecture-specific library directory patterns */
+#define OHOS_ARCH_LIB_PATTERN "/usr/lib/%s"
+#define OHOS_GENERIC_LIB_PATH "/usr/lib"
+#define OHOS_LIB_FALLBACK_PATH "/lib"
+
+/* CRT file location patterns */
+#define OHOS_CRT_FILE_PATTERN "/usr/lib/%s/%s"
+
+/* Helper fragment for feeding multi-arch include dirs into SUBTARGET_CPP_SPEC. */
+#define OHOS_MULTIARCH_INCLUDE_SPEC(archdir) \
+  " %{!nostdinc:%{!fself-test=*: -idirafter %R/usr/include/" archdir "}}"
+
+/* Standard OpenHarmony target triplets */
+#define OHOS_AARCH64_TRIPLET "aarch64-linux-ohos"
+#define OHOS_ARM_TRIPLET "arm-linux-ohos"
+#define OHOS_X86_64_TRIPLET "x86_64-linux-ohos"
+
+/* Helper macros for path construction */
+#define OHOS_SYSROOT_PATH(path) "%R" path
+#define OHOS_ARCH_PATH(base, arch) base "/" arch
+#define OHOS_CRT_PATH(arch, file) "/usr/lib/" arch "/" file
+
+/* Standard search path lists for different file types */
+#define OHOS_STANDARD_INCLUDE_PATHS \
+  { OHOS_SYSROOT_PATH(OHOS_ARCH_PATH("/usr/include", OHOS_TARGET_ARCH)), \
+    OHOS_SYSROOT_PATH("/usr/include"), \
+    NULL }
+
+#define OHOS_STANDARD_LIB_PATHS \
+  { OHOS_SYSROOT_PATH(OHOS_ARCH_PATH("/usr/lib", OHOS_TARGET_ARCH)), \
+    OHOS_SYSROOT_PATH("/usr/lib"), \
+    OHOS_SYSROOT_PATH(OHOS_ARCH_PATH("/lib", OHOS_TARGET_ARCH)), \
+    OHOS_SYSROOT_PATH("/lib"), \
+    NULL }
+
+/* CRT files standard locations */
+#define OHOS_CRT1_PATH OHOS_CRT_PATH(OHOS_TARGET_ARCH, "crt1.o")
+#define OHOS_CRTI_PATH OHOS_CRT_PATH(OHOS_TARGET_ARCH, "crti.o")
+#define OHOS_CRTN_PATH OHOS_CRT_PATH(OHOS_TARGET_ARCH, "crtn.o")
+
+#endif /* GCC_OHOS_PATHS_H */
diff --git a/gcc/config/ohos.h b/gcc/config/ohos.h
new file mode 100644
index 000000000..e44fe51b1
--- /dev/null
+++ b/gcc/config/ohos.h
@@ -0,0 +1,152 @@
+/* OpenHarmony (OHOS) configuration.
+   Copyright (C) 2024 Free Software Foundation, Inc.
+
+This file is part of GCC.
+
+GCC is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 3, or (at your option)
+any later version.
+
+GCC is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with GCC; see the file COPYING3.  If not see
+<http://www.gnu.org/licenses/>.  */
+
+/* OpenHarmony uses musl libc but with some differences */
+#undef OPTION_GLIBC
+#define OPTION_GLIBC 0
+#undef OPTION_UCLIBC
+#define OPTION_UCLIBC 0
+#undef OPTION_BIONIC
+#define OPTION_BIONIC 0
+#undef OPTION_MUSL
+#define OPTION_MUSL 1
+
+/* Base OpenHarmony target OS defines - used by architecture-specific headers */
+#define OHOS_BASE_OS_CPP_BUILTINS()				\
+  do {								\
+    builtin_define ("__ohos__");				\
+    builtin_define ("__OpenHarmony__");				\
+    builtin_define ("__MUSL__");				\
+    builtin_assert ("target=ohos");				\
+    builtin_assert ("target=openharmony");			\
+  } while (0)
+
+
+/* OpenHarmony-specific libc selection */
+#ifndef CHOOSE_DYNAMIC_LINKER
+#define CHOOSE_DYNAMIC_LINKER(G, U, B, M, O) O
+#endif
+
+/* OpenHarmony uses musl-style dynamic linker paths similar to LLVM/Clang.
+   The dynamic linker path is constructed as "/lib/ld-musl-<arch>.so.1"
+   where <arch> is architecture-specific and may include ABI suffixes. */
+
+/* Dynamic linker configuration
+   Each architecture-specific ohos header should define OHOS_ARCH_DYNAMIC_LINKER
+   following the pattern: /lib/ld-musl-{arch}.so.1 */
+
+/* Primary dynamic linker macro - must be defined by arch-specific headers */
+#define OHOS_DYNAMIC_LINKER OHOS_ARCH_DYNAMIC_LINKER
+
+/* Standard library and runtime support - follow LLVM's Unix-style paths */
+#define STANDARD_STARTFILE_PREFIX_1 "/usr/lib/"
+#define STANDARD_STARTFILE_PREFIX_2 "/lib/"
+
+/* Thread model */
+#undef TARGET_THREAD_FILE
+#define TARGET_THREAD_FILE "posix"
+
+/* Enable stack protector by default (OpenHarmony security feature) */
+#ifndef CC1_SPEC
+#define CC1_SPEC ""
+#endif
+
+#undef CC1_SPEC
+#define CC1_SPEC \
+  CC1_SPEC " %{!fno-stack-protector:%{!fstack-protector-all:%{!fstack-protector-strong:%{!fstack-protector:-fstack-protector}}}}"
+
+/* Link spec is defined by architecture-specific ohos headers */
+
+/* Default to position independent executables */
+#ifndef CC1_SPEC
+#define CC1_SPEC ""
+#endif
+
+#ifndef CC1PLUS_SPEC
+#define CC1PLUS_SPEC ""
+#endif
+
+#ifndef LINK_PIE_SPEC
+#ifdef HAVE_LD_PIE
+#define LINK_PIE_SPEC "%{!shared:%{!static:%{!r:-pie}}} "
+#else
+#define LINK_PIE_SPEC ""
+#endif
+#endif
+
+/* OpenHarmony sysroot structure support */
+/* Standard library paths for OHOS - use architecture-specific subdirectories */
+#define OHOS_LIB_SPEC \
+  "%{!nostdlib: \
+     %{!nodefaultlibs: \
+       %{shared:-lc} \
+       %{!shared:%{profile:-lc_p}%{!profile:-lc}} \
+       %{pthread:-lpthread}}}"
+
+/* OHOS uses architecture-specific library directories */
+#ifndef STARTFILE_SPEC
+#define STARTFILE_SPEC \
+  "%{!shared: \
+     %{pg|p|profile:gcrt1.o%s;pie:Scrt1.o%s;:crt1.o%s}} \
+   crti.o%s %{static:crtbeginT.o%s;shared|pie:crtbeginS.o%s;:crtbegin.o%s}"
+#endif
+
+#ifndef ENDFILE_SPEC
+#define ENDFILE_SPEC \
+  "%{shared|pie:crtendS.o%s;:crtend.o%s} crtn.o%s"
+#endif
+
+/* Override LIB_SPEC to use OHOS library specification */
+#ifndef LIB_SPEC
+#define LIB_SPEC OHOS_LIB_SPEC
+#endif
+
+/* Use the same unwinding mechanism as Linux */
+/* Note: MD_UNWIND_SUPPORT is poisoned in newer GCC versions, commenting out */
+/* #define MD_UNWIND_SUPPORT "config/linux-unwind.h" */
+
+/* OpenHarmony runtime library configuration */
+/* Note: GCC uses libgcc runtime library with musl libc.
+   libgcc is fully compatible with musl - it provides low-level compiler
+   runtime support (integer arithmetic, exception handling, etc.) that
+   works independently of the C library implementation.
+   Unlike LLVM's compiler-rt, libgcc + musl is a well-established combination
+   used by many Linux distributions (Alpine, OpenWrt, etc.). */
+
+/* OpenHarmony C++ standard library configuration */
+/* Encourage libc++ usage for OHOS compatibility, but allow libstdc++ fallback */
+#ifndef CPLUSPLUS_CPP_SPEC
+#define CPLUSPLUS_CPP_SPEC "-D_GNU_SOURCE"
+#endif
+
+/* Default to libc++ for C++ programs when possible */
+#ifndef CPLUSPLUS_LIB_SPEC
+#define CPLUSPLUS_LIB_SPEC \
+  "%{!nostdlib++: \
+     %{!stdlib=libstdc++: \
+       -lc++ -lc++abi} \
+     %{stdlib=libstdc++: \
+       -lstdc++}} \
+   -lc"
+#endif
+
+/* Runtime library information */
+#define OHOS_RUNTIME_INFO \
+  "OHOS GCC toolchain: musl libc + libgcc runtime. " \
+  "This combination is fully supported and widely used in production."
diff --git a/gcc/config/riscv/riscv-ohos.h b/gcc/config/riscv/riscv-ohos.h
new file mode 100644
index 000000000..9a78d0fee
--- /dev/null
+++ b/gcc/config/riscv/riscv-ohos.h
@@ -0,0 +1,127 @@
+/* Definitions for RISC-V running OpenHarmony (OHOS).
+   Copyright (C) 2024 Free Software Foundation, Inc.
+
+   This file is part of GCC.
+
+   GCC is free software; you can redistribute it and/or modify it
+   under the terms of the GNU General Public License as published by
+   the Free Software Foundation; either version 3, or (at your option)
+   any later version.
+
+   GCC is distributed in the hope that it will be useful, but
+   WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   General Public License for more details.
+
+   You should have received a copy of the GNU General Public License
+   along with GCC; see the file COPYING3.  If not see
+   <http://www.gnu.org/licenses/>.  */
+
+#ifndef GCC_RISCV_OHOS_H
+#define GCC_RISCV_OHOS_H
+
+/* Define architecture-specific dynamic linker */
+#ifdef TARGET_64BIT_DEFAULT
+# define OHOS_ARCH_DYNAMIC_LINKER "/lib/ld-musl-riscv64.so.1"
+#else
+# define OHOS_ARCH_DYNAMIC_LINKER "/lib/ld-musl-riscv32.so.1"
+#endif
+
+/* Include the generic OpenHarmony configuration */
+/* Note: ohos.h is already included via tm.h, no need to include again */
+
+/* RISC-V-specific OpenHarmony defines - override Linux configuration */
+#ifdef TARGET_OS_CPP_BUILTINS
+#undef TARGET_OS_CPP_BUILTINS
+#endif
+#define TARGET_OS_CPP_BUILTINS()		\
+  do						\
+    {						\
+      /* Include base GNU and OHOS defines */ \
+      GNU_USER_TARGET_OS_CPP_BUILTINS ();	\
+      OHOS_BASE_OS_CPP_BUILTINS();		\
+      /* RISC-V specific defines */ \
+      builtin_define ("__riscv");		\
+      builtin_assert ("cpu=riscv");		\
+      builtin_assert ("machine=riscv");		\
+    }						\
+  while (0)
+
+/* OpenHarmony library paths for RISC-V */
+#ifdef TARGET_64BIT_DEFAULT
+# define OHOS_ARCH_LIB_DIR "riscv64-linux-ohos"
+#else
+# define OHOS_ARCH_LIB_DIR "riscv32-linux-ohos"
+#endif
+
+/* Inject architecture-specific include directories via the CPP spec. */
+#define OHOS_MULTIARCH_CPP_SPEC OHOS_MULTIARCH_INCLUDE_SPEC(OHOS_ARCH_LIB_DIR)
+#ifndef SUBTARGET_CPP_SPEC
+#define SUBTARGET_CPP_SPEC ""
+#endif
+#define OHOS_PREV_SUBTARGET_CPP_SPEC SUBTARGET_CPP_SPEC
+#undef SUBTARGET_CPP_SPEC
+#define SUBTARGET_CPP_SPEC OHOS_PREV_SUBTARGET_CPP_SPEC OHOS_MULTIARCH_CPP_SPEC
+#undef OHOS_PREV_SUBTARGET_CPP_SPEC
+#undef OHOS_MULTIARCH_CPP_SPEC
+
+/* Enhanced library search paths for OpenHarmony */
+#undef STANDARD_STARTFILE_PREFIX_1
+#define STANDARD_STARTFILE_PREFIX_1 "/usr/lib/"
+
+#undef STANDARD_STARTFILE_PREFIX_2
+#define STANDARD_STARTFILE_PREFIX_2 "/lib/"
+
+/* Add architecture-specific library directories for OHOS */
+#undef MD_EXEC_PREFIX
+#define MD_EXEC_PREFIX "/usr/lib/" OHOS_ARCH_LIB_DIR "/"
+
+#undef MD_STARTFILE_PREFIX
+#define MD_STARTFILE_PREFIX "/usr/lib/" OHOS_ARCH_LIB_DIR "/"
+
+#undef MD_STARTFILE_PREFIX_1
+#define MD_STARTFILE_PREFIX_1 "/lib/" OHOS_ARCH_LIB_DIR "/"
+
+/* Override STARTFILE and ENDFILE specs to use architecture-specific paths */
+#undef STARTFILE_SPEC
+#define STARTFILE_SPEC \
+  "%{!shared: \
+     %{pg|p|profile:%R/usr/lib/" OHOS_ARCH_LIB_DIR "/gcrt1.o%s; \
+       pie:%R/usr/lib/" OHOS_ARCH_LIB_DIR "/Scrt1.o%s; \
+       :%R/usr/lib/" OHOS_ARCH_LIB_DIR "/crt1.o%s}} \
+   %R/usr/lib/" OHOS_ARCH_LIB_DIR "/crti.o%s \
+   %{static:crtbeginT.o%s;shared|pie:crtbeginS.o%s;:crtbegin.o%s}"
+
+#undef ENDFILE_SPEC
+#define ENDFILE_SPEC \
+  "%{shared|pie:crtendS.o%s;:crtend.o%s} \
+   %R/usr/lib/" OHOS_ARCH_LIB_DIR "/crtn.o%s"
+#ifdef LINK_SPEC
+#undef LINK_SPEC
+#endif
+/* Define the link spec for RISC-V OpenHarmony */
+#define LINK_SPEC						\
+  "%{mno-relax:--no-relax} "					\
+  "%{mbig-endian:-EB} "						\
+  "%{mlittle-endian:-EL} "					\
+  "%{shared:-shared} "						\
+  "%{!shared: "							\
+    "%{!static: "						\
+      "%{rdynamic:-export-dynamic} "				\
+      "-dynamic-linker " OHOS_DYNAMIC_LINKER "} "		\
+    "%{static:-static}} "					\
+  "-L%R/usr/lib/" OHOS_ARCH_LIB_DIR " "				\
+  "-L%R/usr/lib " 						\
+  "-L%R/lib/" OHOS_ARCH_LIB_DIR " "				\
+  "-L%R/lib "
+
+/* RISC-V OpenHarmony uses relaxation by default */
+#ifndef TARGET_DEFAULT_RELAX
+#define TARGET_DEFAULT_RELAX 1
+#endif
+
+/* Default to async unwind tables */
+#undef TARGET_DEFAULT_ASYNC_UNWIND_TABLES
+#define TARGET_DEFAULT_ASYNC_UNWIND_TABLES 1
+
+#endif /* GCC_RISCV_OHOS_H */
diff --git a/gcc/config/t-ohos b/gcc/config/t-ohos
new file mode 100644
index 000000000..b45633a3c
--- /dev/null
+++ b/gcc/config/t-ohos
@@ -0,0 +1,2 @@
+MULTIARCH_DIRNAME := $(subst -linux-gnu,-linux-ohos,$(MULTIARCH_DIRNAME))
+MULTILIB_OSDIRNAMES := $(subst -linux-gnu,-linux-ohos,$(MULTILIB_OSDIRNAMES))
diff --git a/gcc/system.h b/gcc/system.h
index e516b49d0..74eabeeb4 100644
--- a/gcc/system.h
+++ b/gcc/system.h
@@ -22,6 +22,12 @@ along with GCC; see the file COPYING3.  If not see
 #ifndef GCC_SYSTEM_H
 #define GCC_SYSTEM_H
 
+/* Provide compatibility for __GLIBC_PREREQ on non-glibc systems.
+   This must be defined early before any system headers are included. */
+#ifndef __GLIBC_PREREQ
+#define __GLIBC_PREREQ(x, y) 0
+#endif
+
 /* Define this so that inttypes.h defines the PRI?64 macros even
    when compiling with a C++ compiler.  Define it here so in the
    event inttypes.h gets pulled in by another header it is already
diff --git a/libcpp/system.h b/libcpp/system.h
index cfc9ddaa3..8d2d6d73d 100644
--- a/libcpp/system.h
+++ b/libcpp/system.h
@@ -25,6 +25,11 @@ along with GCC; see the file COPYING3.  If not see
 /* We must include stdarg.h before stdio.h.  */
 #include <stdarg.h>
 
+/* Compatibility fix for __GLIBC_PREREQ when cross-compiling */
+#ifndef __GLIBC_PREREQ
+#define __GLIBC_PREREQ(x, y) 0
+#endif
+
 #ifdef HAVE_STDDEF_H
 # include <stddef.h>
 #endif
diff --git a/libgcc/config.host b/libgcc/config.host
index 6a88ee5a2..ec8f6954d 100644
--- a/libgcc/config.host
+++ b/libgcc/config.host
@@ -435,6 +435,15 @@ aarch64*-*-fuchsia*)
 	tmake_file="${tmake_file} ${cpu_type}/t-softfp t-softfp"
 	tmake_file="${tmake_file} t-dfprules"
 	;;
+aarch64*-*-linux-ohos*)
+	extra_parts="$extra_parts crtfastmath.o"
+	md_unwind_def_header=aarch64/aarch64-unwind-def.h
+	md_unwind_header=aarch64/linux-unwind.h
+	tmake_file="${tmake_file} ${cpu_type}/t-aarch64"
+	tmake_file="${tmake_file} ${cpu_type}/t-lse t-slibgcc-libgcc"
+	tmake_file="${tmake_file} t-softfp ${cpu_type}/t-softfp"
+	tmake_file="${tmake_file} t-dfprules"
+	;;
 aarch64*-*-linux*)
 	extra_parts="$extra_parts crtfastmath.o"
 	md_unwind_def_header=aarch64/aarch64-unwind-def.h
diff --git a/libgcc/gthr-posix.h b/libgcc/gthr-posix.h
index eeb84f32d..1b5cd8bc5 100644
--- a/libgcc/gthr-posix.h
+++ b/libgcc/gthr-posix.h
@@ -129,7 +129,7 @@ __gthrw(pthread_join)
 __gthrw(pthread_equal)
 __gthrw(pthread_self)
 __gthrw(pthread_detach)
-#ifndef __BIONIC__
+#if !defined(__BIONIC__) && !defined(__OHOS__)
 __gthrw(pthread_cancel)
 #endif
 __gthrw(sched_yield)
@@ -275,7 +275,7 @@ __gthrw2(__gthrw_(__pthread_key_create),
 	 __pthread_key_create,
 	 pthread_key_create)
 # define GTHR_ACTIVE_PROXY	__gthrw_(__pthread_key_create)
-#elif defined (__BIONIC__)
+#elif defined (__BIONIC__) || defined (__OHOS__)
 # define GTHR_ACTIVE_PROXY	__gthrw_(pthread_create)
 #else
 # define GTHR_ACTIVE_PROXY	__gthrw_(pthread_cancel)
diff --git a/libstdc++-v3/configure.host b/libstdc++-v3/configure.host
index 253e5a9ad..b2af509fb 100644
--- a/libstdc++-v3/configure.host
+++ b/libstdc++-v3/configure.host
@@ -268,6 +268,9 @@ case "${host_os}" in
   linux-musl*)
     os_include_dir="os/generic"
     ;;
+  linux-ohos*)
+    os_include_dir="os/generic"
+    ;;
   gnu* | linux* | kfreebsd*-gnu | uclinux*)
     if [ "$uclibc" = "yes" ]; then
       os_include_dir="os/uclibc"
