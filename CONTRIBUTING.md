# è´¡çŒ®æŒ‡å—

æ„Ÿè°¢ä½ å¯¹ ohos-gcc é¡¹ç›®çš„å…³æ³¨ï¼æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ã€‚

## å¦‚ä½•è´¡çŒ®

### æŠ¥å‘Šé—®é¢˜

å¦‚æœä½ å‘ç°äº† bug æˆ–æœ‰åŠŸèƒ½å»ºè®®ï¼Œè¯·é€šè¿‡ GitHub Issues æŠ¥å‘Šï¼š

1. æ£€æŸ¥æ˜¯å¦å·²æœ‰ç›¸å…³ issue
2. åˆ›å»ºæ–° issueï¼Œæ¸…æ¥šæè¿°é—®é¢˜ï¼š
   - ä½¿ç”¨çš„ GCC ç‰ˆæœ¬
   - ç›®æ ‡æ¶æ„
   - å¤ç°æ­¥éª¤
   - é¢„æœŸè¡Œä¸ºå’Œå®é™…è¡Œä¸º
   - ç›¸å…³æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯

### æäº¤ä»£ç 

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

## å¼€å‘ç¯å¢ƒè·å–

ç›®å‰é¸¿è’™ç”µè„‘çš„æƒé™å¡çš„å¤ªæ­»ï¼Œæ¨èä½¿ç”¨ [openharmony docker image](https://github.com/hqzing/docker-mini-openharmony) è¿›è¡Œå¼€å‘ã€‚

### å¿…éœ€å·¥å…·

```bash
# Ubuntu/Debian
sudo apt-get install -y \
    build-essential \
    git \
    shellcheck \
    bison \
    flex \
    texinfo \
    gawk \
    zip \
    libgmp-dev \
    libmpfr-dev \
    libmpc-dev \
    zlib1g-dev

# Fedora/RHEL
sudo dnf install -y \
    gcc \
    gcc-c++ \
    git \
    ShellCheck \
    bison \
    flex \
    texinfo \
    gawk \
    zip \
    gmp-devel \
    mpfr-devel \
    libmpc-devel \
    zlib-devel
```

### ä»£ç è§„èŒƒ

#### Shell è„šæœ¬

- ä½¿ç”¨ 4 ç©ºæ ¼ç¼©è¿›
- å‡½æ•°åä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”ï¼ˆ`my_function`ï¼‰
- å˜é‡åä½¿ç”¨å¤§å†™å­—æ¯ï¼ˆ`MY_VARIABLE`ï¼‰
- æ·»åŠ å¿…è¦çš„æ³¨é‡Š
- ä½¿ç”¨ `set -e` ç¡®ä¿é”™è¯¯æ—¶é€€å‡º
- ä½¿ç”¨ shellcheck æ£€æŸ¥è„šæœ¬

```bash
# æ£€æŸ¥è„šæœ¬
shellcheck build.sh
```

#### è¡¥ä¸æ–‡ä»¶

- è¡¥ä¸æ–‡ä»¶åº”è¯¥ï¼š
  - æœ‰æ¸…æ™°çš„æäº¤ä¿¡æ¯
  - åŒ…å« ChangeLog æ¡ç›®
  - éµå¾ª GCC ä»£ç é£æ ¼
  - åœ¨å¤šä¸ªæ¶æ„ä¸Šæµ‹è¯•

### æäº¤ä¿¡æ¯è§„èŒƒ

ä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯ï¼š

```
<ç±»å‹>: <ç®€çŸ­æè¿°>

<è¯¦ç»†æè¿°>

<ç›¸å…³ issue>
```

ç±»å‹åŒ…æ‹¬ï¼š
- `feat`: æ–°åŠŸèƒ½
- `fix`: bug ä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- `refactor`: é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»º/å·¥å…·é“¾ç›¸å…³

ç¤ºä¾‹ï¼š

```
feat: æ·»åŠ  LoongArch æ¶æ„æ”¯æŒ

- æ·»åŠ  loongarch64-linux-ohos ç›®æ ‡
- æ›´æ–°æ¶æ„æ£€æµ‹é€»è¾‘
- æ·»åŠ  LoongArch ç‰¹å®šé…ç½®

Closes #123
```

## æµ‹è¯•æ›´æ”¹

åœ¨æäº¤ PR ä¹‹å‰ï¼Œè¯·ç¡®ä¿ï¼š

1. è„šæœ¬é€šè¿‡ shellcheck æ£€æŸ¥
2. åœ¨è‡³å°‘ä¸€ä¸ªæ¶æ„ä¸Šæµ‹è¯•æ„å»º
3. æ›´æ–°ç›¸å…³æ–‡æ¡£
4. æ·»åŠ æˆ–æ›´æ–°æµ‹è¯•ç”¨ä¾‹

```bash
# è¿è¡Œ shellcheck
shellcheck build.sh build-examples.sh test-toolchain.sh

# æµ‹è¯•æ„å»º
./build.sh --target=aarch64-linux-ohos --prefix=/tmp/test-gcc

# æµ‹è¯•å·¥å…·é“¾
./test-toolchain.sh /tmp/test-gcc aarch64-linux-ohos
```

## è´¡çŒ®é¢†åŸŸ

æˆ‘ä»¬ç‰¹åˆ«æ¬¢è¿ä»¥ä¸‹æ–¹é¢çš„è´¡çŒ®ï¼š

### 1. æ¶æ„æ”¯æŒ

- æ·»åŠ æ–°æ¶æ„æ”¯æŒï¼ˆå¦‚ LoongArchï¼‰
- ä¼˜åŒ–ç°æœ‰æ¶æ„é…ç½®
- ä¿®å¤æ¶æ„ç‰¹å®šé—®é¢˜

### 2. è¡¥ä¸ç»´æŠ¤

- æ›´æ–°ç°æœ‰è¡¥ä¸ä»¥å…¼å®¹æ–°ç‰ˆæœ¬ GCC
- æ·»åŠ æ–°çš„ OHOS ç‰¹å®šä¼˜åŒ–
- ä¿®å¤è¡¥ä¸ç›¸å…³é—®é¢˜

### 3. æ–‡æ¡£æ”¹è¿›

- æ”¹è¿›æ„å»ºæ–‡æ¡£
- æ·»åŠ ä½¿ç”¨ç¤ºä¾‹
- ç¿»è¯‘æ–‡æ¡£ï¼ˆè‹±æ–‡ã€ä¸­æ–‡ï¼‰
- æ·»åŠ æ¶æ„ç‰¹å®šè¯´æ˜

### 4. æµ‹è¯•

- æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•
- åœ¨ä¸åŒå¹³å°ä¸Šæµ‹è¯•
- æŠ¥å‘Šæµ‹è¯•ç»“æœ

### 5. å·¥å…·æ”¹è¿›

- æ”¹è¿›æ„å»ºè„šæœ¬
- æ·»åŠ æ–°çš„è¾…åŠ©å·¥å…·
- ä¼˜åŒ–æ„å»ºæ€§èƒ½

## è¡¥ä¸æäº¤æµç¨‹

å¦‚æœä½ è¦æ·»åŠ æˆ–ä¿®æ”¹ GCC è¡¥ä¸ï¼š

### 1. åˆ›å»ºè¡¥ä¸

```bash
cd gcc-15.2.0
# ä¿®æ”¹ä»£ç 
git add .
git commit -m "ä½ çš„ä¿®æ”¹è¯´æ˜"
git format-patch -1
```

### 2. å‘½åè¡¥ä¸

ä½¿ç”¨ç¼–å·å‰ç¼€ï¼š

```
0XXX-<ç®€çŸ­æè¿°>.patch
```

ä¾‹å¦‚ï¼š
```
0001-Add-OpenHarmony-OHOS-target-support-to-GCC.patch
0042-Add-LoongArch-support.patch
```

### 3. æ·»åŠ  ChangeLog

è¡¥ä¸åº”åŒ…å«è¯¦ç»†çš„ ChangeLogï¼š

```diff
Subject: [PATCH] Add LoongArch support

This patch adds support for LoongArch architecture...

ChangeLog:

	* config.gcc: Add loongarch64-*-linux-ohos* target.
	* config/loongarch/loongarch-ohos.h: New file.
```

### 4. æµ‹è¯•è¡¥ä¸

```bash
# åº”ç”¨è¡¥ä¸
cd gcc-15.2.0
patch -p1 < ../patches/0042-Add-LoongArch-support.patch

# æ„å»ºæµ‹è¯•
cd ..
./build.sh --target=loongarch64-linux-ohos
```

## è¡Œä¸ºå‡†åˆ™

### æˆ‘ä»¬çš„æ‰¿è¯º

ä¸ºäº†è¥é€ å¼€æ”¾å’Œå‹å¥½çš„ç¯å¢ƒï¼Œæˆ‘ä»¬æ‰¿è¯ºï¼š

- ä½¿ç”¨å‹å¥½å’ŒåŒ…å®¹çš„è¯­è¨€
- å°Šé‡ä¸åŒçš„è§‚ç‚¹å’Œç»éªŒ
- ä¼˜é›…åœ°æ¥å—å»ºè®¾æ€§æ‰¹è¯„
- å…³æ³¨å¯¹ç¤¾åŒºæœ€æœ‰åˆ©çš„äº‹æƒ…
- å¯¹å…¶ä»–ç¤¾åŒºæˆå‘˜è¡¨ç¤ºåŒç†å¿ƒ

### ä¸å¯æ¥å—çš„è¡Œä¸º

- ä½¿ç”¨æ€§æš—ç¤ºçš„è¯­è¨€æˆ–å›¾åƒ
- ä¾®è¾±/è´¬æŸæ€§è¯„è®ºå’Œäººèº«æ”»å‡»
- å…¬å¼€æˆ–ç§ä¸‹éªšæ‰°
- æœªç»è®¸å¯å‘å¸ƒä»–äººçš„ç§äººä¿¡æ¯
- å…¶ä»–ä¸é“å¾·æˆ–ä¸ä¸“ä¸šçš„è¡Œä¸º

## è·å–å¸®åŠ©

å¦‚æœ‰é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹ [BUILD_OHOS.md](BUILD_OHOS.md)
2. æœç´¢ç°æœ‰ Issues
3. åˆ›å»ºæ–° Issue æé—®
4. è”ç³»ç»´æŠ¤è€…

## è®¸å¯è¯

é€šè¿‡è´¡çŒ®ä»£ç ï¼Œä½ åŒæ„ä½ çš„è´¡çŒ®å°†åœ¨ GPL-3.0 è®¸å¯è¯ä¸‹å‘å¸ƒã€‚

---

å†æ¬¡æ„Ÿè°¢ä½ çš„è´¡çŒ®ï¼ğŸ‰